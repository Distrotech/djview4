#C- This program is free software; you can redistribute it and/or 
#C- modify it under the terms of the GNU General Public License, 
#C- version 2 or any later version.  The license should have
#C- accompanied the program or you may obtain a copy of the 
#C- license from the Free Software Foundation at http://www.fsf.org.
#C- 
#C- This program is distributed in the hope that it will be useful,
#C- but WITHOUT ANY WARRANTY; without even the implied warranty of
#C- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#C- GNU General Public License for more details.


@SET_MAKE@
SHELL = @SHELL@
VPATH = @srcdir@
PACKAGE_NAME = @PACKAGE_NAME@
PACKAGE_VERSION = @PACKAGE_VERSION@

LN_S = @LN_S@
RM = @RM@ 
TOUCH = @TOUCH@
MKDIR = @MKDIR@
LIBTOOL = @LIBTOOL@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
LRELEASE = @LRELEASE@

srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
datarootdir = @datarootdir@
datadir = @datadir@
libdir = @libdir@
mandir = @mandir@

srcdir = @srcdir@
top_srcdir = @top_srcdir@
top_builddir = .

QMAKESUBDIRS=src
@NPDJVU_YES@QMAKESUBDIRS:=${QMAKESUBDIRS} npdjvu

AUTOSUBDIRS=
@NSDEJAVU_YES@AUTOSUBDIRS:=${AUTOSUBDIRS} nsdejavu
@DESKTOP_YES@AUTOSUBDIRS:=${AUTOSUBDIRS} desktopfiles

# make all

all: all-subdirs all-djview-qm

all-subdirs: FORCE
	-for d in ${QMAKESUBDIRS} ; do ( cd $$d && ${MAKE} -f Makefile.qmake ) ; done
	-for d in ${AUTOSUBDIRS} ; do ( cd $$d && ${MAKE} ) ; done

all-djview-qm: FORCE
	-for n in ${srcdir}/src/*.ts ; do \
	   m=`basename $$n` ; cmp $$n src/$$m || cp $$n src/$$m ; done
	-grep TRANSLATIONS src/djview.pro > src/translations.pro
	-cd src && test -x "${LRELEASE}" && "${LRELEASE}" translations.pro

install: install-subdirs install-djview 

install-subdirs: FORCE
	-for d in ${AUTOSUBDIRS} ; do ( cd $$d && ${MAKE} install ) ; done

install-djview: install-djview-bin install-djview-man install-djview-qm

install-djview-bin: FORCE
	${INSTALL} -d ${DESTDIR}${bindir}
	eval `grep '^TARGET *=' src/Makefile | sed -e 's/ *= */=/'` ; \
	  ${INSTALL_PROGRAM} src/$${TARGET-djview} ${DESTDIR}${bindir}/djview4
	cd ${DESTDIR}${bindir} ; ${LN_S} djview4 djview || true

install-djview-man: FORCE
	${INSTALL} -d ${DESTDIR}${mandir}/man1
	${INSTALL_DATA} ${srcdir}/src/djview.1 \
	   ${DESTDIR}${mandir}/man1/djview4.1
	cd ${DESTDIR}${mandir}/man1 ; ${LN_S} djview4.1 djview.1 || true

install-djview-qm: FORCE
	${INSTALL} -d ${DESTDIR}${datadir}/djvu/djview4
	for qm in src/*.qm ; do test -r $$qm && \
          ${INSTALL_DATA} $$qm ${DESTDIR}${datadir}/djvu/djview4 || true ; \
	done

clean: clean-subdirs

clean-subdirs: FORCE
	-for d in ${QMAKESUBDIRS} ; do ( cd $$d && ${MAKE} -f Makefile.qmake clean ) ; done
	-for d in ${AUTOSUBDIRS} ; do ( cd $$d && ${MAKE} clean ) ; done

distclean: distclean-subdirs

distclean-subdirs: FORCE
	-for d in ${QMAKESUBDIRS} ; do ( cd $$d && ${MAKE} -f Makefile.qmake distclean ) ; done
	-for d in ${QMAKESUBDIRS} ; do rm $$d/Makefile.qmake ; done
	-for d in ${AUTOSUBDIRS} ; do ( cd $$d && ${MAKE} distclean ) ; done
 

# phony targets

FORCE:

.PHONY: FORCE





