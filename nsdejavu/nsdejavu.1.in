.Dd September 23, 2015
.Dt NSDEJAVU 1
.Os
.Sh NAME
.Nm nsdejavu
.Nd DjVu browser plugin
.Sh SYNOPSIS
.Nm PLUGINSDIR/NSDEJAVUSO
.Sh DESCRIPTION
The shared library
.Nm NSDEJAVUSO
uses the Netscape browser plugin API to display DjVu images
in a number of popular web browsers.
Different web browsers provide various level of support for Netscape plugins.
Please check the section
.Sx Browser Compatibility
for instructions on how to enable the DjVu browser plugin.
.Pp
The DjVuLibre browser plugin works by invoking a standalone viewer
with the special command line option
.Fl netscape .
The plugin first searches a program named
.Nm djview .
If this program cannot be found,
it searches for
.Nm djview4
and finally
.Nm djview3 .
It is always possible to override this search strategy
by setting the environment variable
.Ev NPX_DJVIEW
to the full path of the desired executable.
.Ss Mime Types and Extensions
Typing the URL of a recognized DjVu document in your web browser
should automatically invoke the DjVu browser plugin.
Each browser uses different methods to determine
that a particular URL is in fact a DjVu document.
Most web browsers recognize files ending with
.Pa djvu
or
.Pa .djv
as DjVu files.
Web servers normally provide a MIME type to web browsers.
The official MIME type for DjVu documents is
.Dq image/vnd.djvu .
For compatibility with ancient versions of the DjVu viewer,
it is common to use instead the experimental MIME type
.Dq image/x-djvu
or
.Dq image/x.djvu .
.Ss CGI-style Flags
The behavior of the DjVu browser plugin can be specified
by augmenting the URL using a syntax similar to that used
by the CGI programs.
This syntax is described by the following template:
.Dl Lk http://.../file.djvu?djvuopts&keyword=value
The DjVu browser plugin only recognizes keywords that appear after
.Dq djvuopts .
The keywords recognized by each viewer are listed in the man page for
.Xr djview4 1 .
Unrecognized keywords are ignored.
The most common keywords are:
.Bl -tag -width Ds
.It Ic page Ns = Ns Ar pagename
Specify which page is displayed by name or by ordinal number.
.It Ic zoom Ns = Ns Ar zoomfactor
Set the zoom factor.
Legal values of
.Ar zoomfactor
are:
.Pp
.Bl -hang -compact -width one2one
.It Ar number
Magnification factor in the range from 10% to 999%.
.It Cm one2one
Select the
.Dq one-to-one
mode.
.It Cm width
Select the
.Dq fit width
mode.
.It Cm page
Select the
.Dq fit page
mode.
.It Cm stretch
Stretch the image to the plugin window size.
.El
.El
.Ss Browser Compatibility
The DjVu browser plugin has been tested with several popular web browsers:
Netscape 4 and 6; Gecko based browsers such as Mozilla, Galeon and Firefox;
KHTML based browsers such as Konqueror; and Opera.
Please read the browser documentation to find out
where the plugin library should be installed.
.Ss Embedding DjVu Images in HTML Pages
You can integrate DjVu content in an HTML page with the
.Aq embed
or
.Aq object
tag.
This method will work even if your web server
does not support the DjVu MIME type.
The CGI style flags can be directly used as attributes of the embedding tag.
.Pp
The following example shows the
.Aq object
syntax:
.Bd -literal -offset indent
<object data="file.djvu" type="image/vnd.djvu"
	width="100%" height="100%">
	<param name="page" value="iii">
	<param name="zoom" value="stretch">
	This browser cannot render djvu data.
</object>
.Ed
.Pp
and this is the customary
.Aq embed
syntax:
.Bd -literal -offset indent
<embed src="file.djvu" type="image/vnd.djvu"
	width="100%" height="100%"
	page="iii" zoom="stretch">
</embed>
.Ed
.Ss Interfacing with JavaScript
Recent versions of the
.Nm djview4
plugin can be controlled from the JavaScript interpreter
of browsers implementing the Mozilla NPRuntime API.
To access the plugin object, include
.Dq id Ns = Ns pluginname
in the
.Aq object
or
.Aq embed
tag and use the JavaScript
.Fn getElementById pluginname
function.
.Pp
The plugin object implements two methods
to retrieve and set the value of the options
usually recognized as CGI-style flags.
It also can evaluate a specified JavaScript
expression whenever something changes
in the status of the djview interface.
.Bl -tag -width Ds
.It Fn pluginobject.setdjvuopt key value
Set the value of the djvu option
.Fa key
to the string
.Fa value .
This achieves the same effect as specifying
.Ar key Ns = Ns Ar value
among the CGI-style flags.
.It Fn pluginobject.getdjvuopt key
Return the value of the djvu option
.Va key
as a string.
The returned value is always a character string,
even when it is logically a number.
Boolean values are returned as
.Dq yes
or
.Dq no .
Besides the usual CGI-style flags, this function also recognizes
.Cm pages
as
.Fa key
and returns the total number of pages in the DjVu document.
An empty string is returned when the
.Fa key
is not recognized.
.It Va pluginobject.onchange Ns = Ns Ar code
Ensure that
.Ar code
is evaluated in the context of the plugin object
whenever something changes in the djview graphical user interface.
For instance, this evaluation happens
when progressive refinements are painted,
and when the user manipulates the image interactively.
.It Fn pluginobject.version
Return a string describing the plugin version.
This property can be used to test
whether the djview plugin is scriptable in this browser.
.El
.Pp
Note that the scriptability feature may not be accessible
until the djview plugin is fully loaded.
Therefore it is advisable to check
.Fn pluginobject.version
from the JavaScript
.Fn onload
function before calling any other method.
.Sh SEE ALSO
.Xr ddjvu 1 ,
.Xr djview4 1 ,
.Xr djvu 1
.Sh AUTHORS
.An Andrei Erofeev Aq Mt andrew_erofeev@yahoo.com
.An Bill Riemers Aq Mt docbill@sourceforge.net
.An Leon Bottou Aq Mt leonb@users.sourceforge.net
