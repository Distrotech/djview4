#!/bin/sh

#C- This program is free software; you can redistribute it and/or
#C- modify it under the terms of the GNU General Public License,
#C- version 2.  The license should have accompanied the program
#C- or you may obtain a copy of the license from the Free Software
#C- Foundation at http://www.fsf.org.
#C-
#C- This program is distributed in the hope that it will be useful,
#C- but WITHOUT ANY WARRANTY; without even the implied warranty of
#C- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#C- GNU General Public License for more details.
#C-
#C- $Id$


xdg_mime=XDG_MIME
xdg_icon_resource=XDG_ICON_RESOURCE
xdg_desktop_menu=XDG_DESKTOP_MENU
datadir=DATADIR
mydir=MYDIR

# test directory
if test -d "$mydir" 
then
  cd ${mydir}
else
  echo 1>&2 "Unable to find directory ${mydir}"
  exit 10
fi


# check presence of xdg utils
test -x ${xdg_mime} || xdg_mime=`which xdg-mime`
test -x ${xdg_icon_resource} || xdg_icon_resource=`which xdg-icon-resource`
test -x ${xdg_desktop_menu} || xdg_desktop_menu=`which xdg-icon-resource`

if test -x ${xdg_mime} &&
   test -x ${xdg_icon_resource} &&
   test -x ${xdg_desktop_menu} 
then
   true
else
   echo 1>&2 "Unable to find the Xdg Portland utils"
   echo 1>&2 " These are needed to run $0".
   echo 1>&2 " Please check http://portland.freedesktop.org."
   exit 10
fi

if test -n "$XDG_DATA_DIR" ; then
    XDG_DATA_DIR="$DATADIR:$XDG_DATA_DIR"
else
    XDG_DATA_DIR="$DATADIR:/usr/local/share/:/usr/share/"
fi
export XDG_DATA_DIR

# proceed
case "$1" in
install)
   ${xdg_icon_resource} install --context apps \
       --size 32 ./hi32-djview4.png djvulibre-djview4
   ${xdg_desktop_menu} install ./djvulibre-djview4.desktop
   ;;
uninstall)
   ${xdg_icon_resource} uninstall --context apps \
       --size 32 djvulibre-djview4
   ${xdg_desktop_menu} uninstall djvulibre-djview4.desktop
   ;;
*)
   echo 1>&2 "Usage: $0 {install|uninstall}"
   exit 10
   ;;
esac
